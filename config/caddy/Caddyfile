# Replace example.com with your real domain (ensure DNS A/AAAA points to your WAN IP)
# Caddy will obtain/renew Let's Encrypt certificates automatically.
# If you want to use a wildcard or internal CA, adjust accordingly.

christmas.snek2.ddns.net {
	root * /srv/christmas-party
	file_server
	encode gzip
}

snek2.ddns.net {
	encode gzip

	# Forward all traffic to Home Assistant container
	reverse_proxy homeassistant:8123 {
		# Preserve websocket + headers automatically; explicit options if needed
		transport http {
			compression off
		}
	}

	# Optional: security/headers tweaks
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy no-referrer
		X-Content-Type-Options nosniff
		X-Frame-Options SAMEORIGIN
		X-XSS-Protection "1; mode=block"
	}

	# Optional: allow local HTTP->HTTPS redirects
	redir /.well-known/carddav /remote.php/dav 308
	redir /.well-known/caldav /remote.php/dav 308
}

schniff.snek2.ddns.net {
	encode gzip

	reverse_proxy schniffer-bot:8069 {
		transport http {
			compression off
		}
	}

	# Optional: security/headers tweaks
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy no-referrer
		X-Content-Type-Options nosniff
		X-Frame-Options SAMEORIGIN
		X-XSS-Protection "1; mode=block"
	}
}

ppp.snek2.ddns.net {
	encode gzip

	reverse_proxy ppp:8040 {
		transport http {
			compression off
		}
	}

	# Optional: security/headers tweaks
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy no-referrer
		X-Content-Type-Options nosniff
		X-Frame-Options SAMEORIGIN
		X-XSS-Protection "1; mode=block"
	}
}

esphome.snek2.ddns.net {
	encode gzip

	basic_auth / {
		{env.ESPHOME_USERNAME} {env.ESPHOME_PASSWORD}
	}

	reverse_proxy esphome:6052 {
		transport http {
			compression off
		}
	}

	# Optional: security/headers tweaks
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy no-referrer
		X-Content-Type-Options nosniff
		X-Frame-Options SAMEORIGIN
		X-XSS-Protection "1; mode=block"
	}
}

pal.snek2.ddns.net {
	encode gzip

	reverse_proxy palworld:8212 {
		transport http {
			compression off
		}
	}

	# Optional: security/headers tweaks
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy no-referrer
		X-Content-Type-Options nosniff
		X-Frame-Options SAMEORIGIN
		X-XSS-Protection "1; mode=block"
	}
}

# (Optional) HTTP->HTTPS redirect if someone hits plain 80 with host
http://snek2.ddns.net {
	redir https://snek2.ddns.net{uri} 308
}

# HTTP->HTTPS redirect for schniff subdomain
http://schniff.snek2.ddns.net {
	redir https://schniff.snek2.ddns.net{uri} 308
}

# HTTP->HTTPS redirect for ppp subdomain
http://ppp.snek2.ddns.net {
	redir https://ppp.snek2.ddns.net{uri} 308
}

# HTTP->HTTPS redirect for esphome subdomain
http://esphome.snek2.ddns.net {
	redir https://esphome.snek2.ddns.net{uri} 308
}

# HTTP->HTTPS redirect for pal subdomain
http://pal.snek2.ddns.net {
	redir https://pal.snek2.ddns.net{uri} 308
}
