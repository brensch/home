esphome:
  name: "fridge"
  friendly_name: "fridge"

esp8266:
  board: esp01_1m

# --- UART CONFIGURATION (FIXED) ---
# The CSE7766 requires 4800 baud, Even parity, and 1 stop bit.
uart:
  rx_pin: RX
  baud_rate: 4800
  parity: EVEN
  stop_bits: 1

# Logger must use baud_rate: 0 to avoid conflict with the UART sensor
logger:
  baud_rate: 0
  level: DEBUG

api:
  encryption:
    key: "gZVt6/DITvTV/FjMEZq2dOHXsd8KC6mDfHxvSk5KOPc="
  # Connect to Home Assistant on the Docker network
  # No need to specify address - ESPHome auto-discovers HA

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # --- STATIC IP SETTINGS ---
  manual_ip:
    static_ip: 192.168.1.66
    gateway: 192.168.1.1
    subnet: 255.255.255.0

  ap:
    ssid: "Yo Fallback Hotspot"
    password: "bummerino"

captive_portal:

# --- TIME COMPONENT ---
# Required for total_daily_energy
time:
  - platform: sntp
    id: sntp_time
    # Set to your specific timezone
    timezone: "America/Los_Angeles"

# --- HARDWARE: BUTTON ---
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
      inverted: True
    name: "Button"
    on_press:
      - switch.toggle: relay

# --- HARDWARE: RELAY ---
switch:
  - platform: gpio
    name: "Relay"
    pin: GPIO12
    id: relay
    restore_mode: RESTORE_DEFAULT_OFF

# --- HARDWARE: LED ---
status_led:
  pin:
    number: GPIO13
    inverted: True

# --- HARDWARE: POWER MONITORING (CSE7766) ---
sensor:
  - platform: cse7766
    voltage:
      name: "Voltage"
      accuracy_decimals: 1
      filters:
        - throttle_average: 1s
    power:
      name: "Power"
      id: power_sensor
      accuracy_decimals: 2
      filters:
        - throttle_average: 1s
    energy:
      name: "Energy"
      accuracy_decimals: 2
      filters:
        - throttle: 60s

